# Сетевые пакеты. VLAN'ы. LACP

## Задание выполнялось с использованием VirtualBox 6.1.40, использовался vagrant с box-образом generic/debian11

## Задание:
- в Office1 в тестовой подсети появляется сервера с доп. интерфесами и адресами в internal сети testLAN  
    testClient1 - 10.10.10.254  
    testClient2 - 10.10.10.254  
    testServer1- 10.10.10.1  
    testServer2- 10.10.10.1  
    развести вланами  
    testClient1 <-> testServer1  
    testClient2 <-> testServer2  
- между centralRouter и inetRouter "пробросить" 2 линка (общая inernal сеть) и объединить их в бонд проверить работу c отключением интерфейсов  

## Размышляем
В ходе выполнения предложенных заданий, как я их понимаю, нам необходимо увидеть следующие возможности:
- Создание и работу с VLAN-интерфейсами в Linux
- Логическую изоляция VLAN
- Агрегацию каналов (bonding\teaming) в Linux 

Решил упростить схему сети до следующей, достаточной для демонстрации вышеуказанных возможностей:
!["Схема разворачиваемой сети"](https://github.com/mus-cat/otus-study-m5l36/blob/master/pic/Network.png)

## Резальтат
С помощью **vagrant** и **ansible** поднимается стенд в котором:
- соответствующие интерфейся ВМ `officeRouter`, `Server1` и `Client1` размещаются в одной виртуальной сети с именем **lan**.  На базе этих интерфейсов создаются VLAN-интерфейсы, в результате начинает ходить тегированный трафик, что обеспечивает логическую изоляцию `Server1` от `Client1`(и наоборот). Т.е. присвоение на VLAN-интерфейс адреса из другой сети не даст нам доступа к это сети. Если к примеру, на VLAN-интерфейс `Client1` назначить адрес из сети `10.0.10.0/24`, то пропинговать `Server1` мы не сможем.  
Пингуем с `Server1` и `Client1` - `officeRouter` видим, что пинг идет.
!["Клиент пингует роутер"](https://github.com/mus-cat/otus-study-m5l36/blob/master/pic/PingClient2router.png)
!["Сервер пингует роутер"](https://github.com/mus-cat/otus-study-m5l36/blob/master/pic/PingServer2router.png)  
Теперь попытался на `Server1` присвоить VLAN-интерфейсу адрес `10.0.11.3` и проверить доступность `Client1`. Как и ожидалось, не достучался...
!["Сервер пингует роутер"](https://github.com/mus-cat/otus-study-m5l36/blob/master/pic/ChangeAndPing.png)
- Интерфейсы **eth1** и **eth2** на каждой из ВМ `inetRouter` и `officeRouter` объеденены в один канал - **team0**.
Проверяем доступнсть `inetRouter` с `officeRouter` при помощи утилиты **ping**, в процессе отключим активный линк и сново его включим :
!["Проверка связи с отключением активного интнрфейса"](https://github.com/mus-cat/otus-study-m5l36/blob/master/pic/ChangeLinkState.png)

## P.S. Замечания
Как видно из картинки демонстрирующей работу агрегированного канала, его работоспособность тестировалась с использованием по **VMWare Player 15.5.7**. Соответствующие интерфейсы ВМ были помещены в отдельные **LAN Segment**, т.е. сетевые адаптеры № 2 на обеих машинах помещены в один сегмент, а адаптеры 3 в другой сегмент.  
Настроить корректное функционирование агрегации каналов в **VirtualBox** с использованием **Внутренней сети (Internal Network)** не удалось.

## Файлы:
- **Vagrant** - файл для создания ВМ и запуска ansible
- **router.yml** - ansible playbook для настройки ВМ `inetRouter` и `officeRouter`
- **pc.yml** - ansible playbook для настройки ВМ `Server1` и `Client1`
- __*.j2__ - шаблоны для настройки сетевых интерфейсов (используются всеми ВМ)
- **teamd@.service** - сервис-шаблон для запуска сервисов вида **teamd@teamd0.service**
- **team0.conf** - параметры конфигурации используемые сервисом **teamd@teamd0.service**
